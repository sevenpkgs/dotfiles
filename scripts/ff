#!/usr/bin/env bash

###       fIND fILES       ###
### A script by @sevenpkgs ###

# finds files in current directory using fzf and opens them in nvim #
# you can also specify what files to look for and where to look in  #
# ex: ./ff md                                                       #

# If a single argument is provided and it's a directory, use it.
if [ "$#" -eq 1 ] && [ -d "$1" ]; then
  DIR="$1"
  EXT=""
else
  EXT="${1:-}"
  DIR="${2:-$(pwd)}"
fi

pushd "$DIR" > /dev/null

# Build the command concisely.
cmd="du -a *"
[ -n "$EXT" ] && cmd="$cmd | grep -i $EXT"
cmd="$cmd | cut -f2-"

FZF_DEFAULT_COMMAND="$cmd" \
  fzf --height=100% --preview-window=right:60%:wrap \
      --preview 'bat --style=plain --theme=gruvbox-dark --color=always {}' \
      --bind 'enter:execute(nvim {})' \
      --bind 'ctrl-r:reload(bash -c "$FZF_DEFAULT_COMMAND")' \
      --bind "ctrl-i:execute(nvim)" \
      --bind 'ctrl-f:execute(search)'

popd > /dev/null
