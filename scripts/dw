#!/usr/bin/env bash

###      dEFINE  wORD      ###
### A script by @sevenpkgs ###

# A simple script to define get definitions, with a pretty output #

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
PURPLE='\033[0;35m'
NC='\033[0m'

[[ -z "$1" ]] && {
  echo -e "${RED}Usage: $0 <word>${NC}"
  exit 1
}
word="$1"

data=$(curl -s "https://api.dictionaryapi.dev/api/v2/entries/en/$word")

# Check if the API returned valid data
[[ $(echo "$data" | jq -r '.[0].word // empty') == "" ]] && {
  echo -e "${RED}No definitions found for '$word'.${NC}"
  exit 1
}

# Display basic information
echo -e "${GREEN}Word:${NC} $(echo "$data" | jq -r '.[0].word')"
echo -e "${CYAN}Phonetic:${NC} $(echo "$data" | jq -r '.[0].phonetic // "N/A"')"
echo -e ""

# Loop through each meaning
echo "$data" | jq -c '.[0].meanings[]' | while read -r meaning; do
  echo -e "${YELLOW} $(echo "$meaning" | jq -r '.partOfSpeech')"
  echo -e "${RED}-----------------------------"

  i=1
  echo "$meaning" | jq -c '.definitions[]' | while read -r def; do
    def_text=$(echo "$def" | jq -r '.definition')
    echo -e "${BLUE}${i}. ${NC}$def_text"
    example=$(echo "$def" | jq -r '.example // empty')
    [[ -n "$example" ]] && echo -e "${PURPLE}   Example:${NC} $example"
    echo ""
    ((i++))
  done
done
